{% extends "admin_layout.html" %}
{% block content %}
{% if agent %}
{% set assign_btn_label = 'Re-Assign' %}
{% else %}
{% set assign_btn_label = 'Assign' %}
{% endif %}
{% if agent.is_working == True %}
{% set status = 'Available' %}
{% set badge_type = 'primary' %}
{% else %}
{% set status = 'Un-Available' %}
{% set badge_type = 'danger' %}
{% endif %}
<br><br>
<script>
  $(document).ready( function() {
      $('#status_update_btn').click(function() {
          $.ajax("{{ url_for('main.get_order_status', order_id=order.id) }}").done(function (reply) {
            $('#div_status').html(reply);
          });
      });
  });
</script>
<div class="container">
  <div class="container card text-left text-white bg-dark">
    <div class="row card-body">
      <div class="col">
        Order ID
      </div>
      <div class="col">
        Pincode
      </div>
      <div class="col">
        Status
      </div>
    </div>
  </div>
  <div class="container card">
    <div class="row card-body">
      <div class="col">
        {{ order.id }}
      </div>
      <div class="col">
        {{ order.cust_pincode }}
      </div>
      <div class="col" id="div_status">
        <span class="badge badge-dark">{{ order.status }}</span>
      </div>
    </div>
  </div>
  <br><br>
  {% if agent %}
  <div class="container card text-center text-white bg-dark">
    Assignee
  </div>
  <div class="container card">
    <a class="nav-item nav-link" href="{{ url_for('main.agent', agent_id=agent.id) }}">
      <div class="row card-body">
        <div class="col">
          {{ agent.username }}
        </div>
        <div class="col">
          {{ agent.phone_no }}
        </div>
        <div class="col">
          <span id="span_status" class="badge badge-{{ badge_type }}">{{ status }}</span>
        </div>
      </div>
    </a>
  </div>
  {% else %}
  <div class="text-black text-center font-weight-bold">
    This order is currently unassigned.
  </div>
  {% endif %}
  <br><br>
  <div class="container card text-center">
    <div class="row card-body">
      <div class="col">
        <a class="btn btn-dark btn" href="{{ url_for('main.assign_view', order_id=order.id) }}">{{ assign_btn_label }} Order</a>
      </div>
      <div class="col" role="group" > 
        <a class="btn btn-dark" href="tel:{{order.phone}}"><span class="fa fa-phone">&nbsp;<strong>Phone</strong></span></a>  
      </div>
      <div class="col">
        <div class="btn-group">
          <button type="button" id="status_update_btn" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Update Status
          </button>
          <div class="dropdown-menu">
            <a class="dropdown-item" href="{{ url_for('main.update_order_status',order_id=order.id, status_option='accepted') }}">Accepted</a>
            <a class="dropdown-item" href="{{ url_for('main.update_order_status',order_id=order.id, status_option='cooking') }}">Preparing your meal</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="{{ url_for('main.update_order_status',order_id=order.id, status_option='eta_30') }}">Your Order is 30 Minutes Away</a>
            <a class="dropdown-item" href="{{ url_for('main.update_order_status',order_id=order.id, status_option='eta_10') }}">Your Order is 10 Minutes Away</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="{{ url_for('main.update_order_status',order_id=order.id, status_option='reached') }}">Your Order has reached your location</a>
            <a class="dropdown-item" href="{{ url_for('main.update_order_status',order_id=order.id, status_option='delivered') }}">Order Delivered</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  <br>
{% endblock content %}